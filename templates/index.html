<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple URL Shortener</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #0f1115;
      --bg-alt: #181b22;
      --panel: #1f232b;
      --panel-alt: #272c35;
      --accent: linear-gradient(135deg,#6366f1,#8b5cf6 55%,#ec4899);
      --accent-solid: #6366f1;
      --accent-glow: 180 100% 50%;
      --text: #f5f7fa;
      --text-dim: #b5bcc8;
      --danger: #ef4444;
      --radius-sm: 6px;
      --radius: 14px;
      --shadow: 0 4px 18px -4px rgba(0,0,0,.4),0 2px 4px -1px rgba(0,0,0,.3);
      --transition: 150ms cubic-bezier(.4,0,.2,1);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif;
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f5f7fb;
        --bg-alt: #eef2f8;
        --panel: #ffffff;
        --panel-alt: #f2f5fa;
        --text: #1b2430;
        --text-dim: #5b6472;
        --shadow: 0 6px 20px -6px rgba(31,41,55,.18),0 4px 6px -2px rgba(31,41,55,.08);
      }
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; min-height: 100dvh; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 2rem;
      background: radial-gradient(circle at 25% 15%,rgba(99,102,241,.25),transparent 60%),
                  radial-gradient(circle at 80% 70%,rgba(236,72,153,.25),transparent 65%),
                  var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }
    .app-shell { width: min(760px,95%); padding: clamp(1.5rem,2.5vw,2.5rem); background: linear-gradient(145deg,var(--panel),var(--panel-alt)); border: 1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); position: relative; overflow: hidden; }
    .app-shell:before { content:""; position:absolute; inset:0; background:linear-gradient(120deg,rgba(255,255,255,.08),transparent 55%); mix-blend-mode: overlay; pointer-events:none; }
    header { display:flex; flex-direction:column; gap:.5rem; }
    h1 { font-size: clamp(1.9rem,3vw,2.4rem); line-height:1.1; margin:0; letter-spacing:.5px; background:var(--accent); -webkit-background-clip:text; color:transparent; }
    p.lead { margin:0; font-size: clamp(.95rem,1.6vw,1.05rem); color: var(--text-dim); max-width: 50ch; }

    form { margin-top: 1.4rem; display: flex; flex-direction: column; gap: .85rem; }
    label { font-size: .78rem; text-transform: uppercase; letter-spacing: .08em; font-weight: 600; color: var(--text-dim); }
    .field-row { display:flex; gap:.8rem; flex-wrap:wrap; }
    input[type=text] {
      flex:1 1 300px; font: inherit; padding:.85rem 1rem; border-radius: var(--radius-sm); border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: var(--text); outline:none; transition: var(--transition); min-width:200px;
    }
    input[type=text]:focus { border-color: var(--accent-solid); box-shadow: 0 0 0 3px rgba(99,102,241,.35); background: rgba(255,255,255,.07); }
    button.primary { position:relative; font: inherit; font-weight:600; padding:.85rem 1.4rem; border-radius: var(--radius-sm); border:none; cursor:pointer; background: var(--accent); color:#fff; display:inline-flex; align-items:center; gap:.55rem; box-shadow:0 4px 14px -4px rgba(99,102,241,.55); transition: var(--transition); }
    button.primary:hover { filter: brightness(1.08); translate: 0 -2px; }
    button.primary:active { translate:0 0; }
    button.primary[disabled] { opacity:.6; cursor: wait; translate:0 0; }
    .spinner { width:1em; height:1em; border:2px solid rgba(255,255,255,.4); border-top-color:#fff; border-radius:50%; animation: spin .8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg);} }

    .result { margin-top: 1.4rem; padding: 1rem 1.1rem; background: linear-gradient(135deg,rgba(99,102,241,.18),rgba(139,92,246,.18)); border:1px solid rgba(99,102,241,.4); border-radius: var(--radius-sm); display:none; font-size:.95rem; line-height:1.4; position:relative; }
    .result code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; padding:.25rem .45rem; background:rgba(0,0,0,.35); border-radius: var(--radius-sm); }
    .actions { display:flex; gap:.6rem; margin-top:.75rem; }
    .btn-alt { font:inherit; font-size:.8rem; padding:.55rem .9rem; border-radius: var(--radius-sm); border:1px solid rgba(255,255,255,.18); background: rgba(255,255,255,.08); color:var(--text); cursor:pointer; display:inline-flex; align-items:center; gap:.4rem; transition: var(--transition); }
    .btn-alt:hover { background: rgba(255,255,255,.16); }
    .btn-alt:active { scale:.97; }
    .copied { position:absolute; top:.6rem; right:.8rem; font-size:.65rem; letter-spacing:.08em; background:rgba(0,0,0,.55); padding:.3rem .55rem; border-radius:999px; opacity:0; transform:translateY(-6px); transition: var(--transition); }
    .copied.show { opacity:1; transform:translateY(0); }

    .error { color: var(--danger); margin-top:.75rem; font-size:.85rem; min-height:1.2em; }
    footer { margin-top: 2.2rem; font-size: .7rem; letter-spacing:.05em; text-transform:uppercase; color: var(--text-dim); text-align:center; }
    a { color: var(--accent-solid); text-decoration:none; }
    a:hover { text-decoration:underline; }

    .fade-in { animation: fade .4s ease; }
    @keyframes fade { from { opacity:0; translate:0 4px;} to { opacity:1; translate:0 0;} }
  </style>
</head>
<body>
  <div class="app-shell fade-in">
    <header>
      <h1>URL Shortener</h1>
      <p class="lead">Shrink long links into clean, shareable short URLs. Prototype only: data resets on server restart.</p>
    </header>
    <form id="shorten-form" method="post" action="/shorten" novalidate>
      <label for="url-input">Long URL</label>
      <div class="field-row">
        <input type="text" name="url" id="url-input" placeholder="https://example.com/very/long/path" autocomplete="off" spellcheck="false" required />
        <button type="submit" class="primary" id="submit-btn">
          <span class="btn-label">Shorten</span>
          <span class="spinner" style="display:none" id="loading-spinner" aria-hidden="true"></span>
        </button>
      </div>
    </form>
    <div id="error" class="error" role="alert" aria-live="polite"></div>
    <div id="result" class="result" aria-live="polite"></div>
    <div class="copied" id="copied-indicator">Copied!</div>
    <footer>In-Memory Demo â€¢ No Persistence â€¢ Base62 Codes</footer>
  </div>

<script>
  const form = document.getElementById('shorten-form');
  const resultBox = document.getElementById('result');
  const errorBox = document.getElementById('error');
  const submitBtn = document.getElementById('submit-btn');
  const spinner = document.getElementById('loading-spinner');
  const copiedIndicator = document.getElementById('copied-indicator');
  
  async function safeParseJSON(resp) {
    const contentType = resp.headers.get('content-type') || '';
    if (!contentType.includes('application/json')) {
      // Fallback to text so we can display something helpful.
      const text = await resp.text();
      if (!text.trim()) return {}; // empty body
      return { _rawText: text };
    }
    if (resp.status === 204) return {}; // No Content
    try {
      return await resp.json();
    } catch (e) {
      return { _parseError: true };
    }
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorBox.textContent = '';
    resultBox.style.display = 'none';
    const urlInput = document.getElementById('url-input');
    const url = urlInput.value.trim();
    if(!url){
      errorBox.textContent = 'Please enter a URL.';
      return;
    }
    try {
      // Basic client-side normalization suggestion
      if (!/^https?:\/\//i.test(url)) {
        errorBox.textContent = 'Add http:// or https:// to your URL.';
        return;
      }
      submitBtn.disabled = true;
      spinner.style.display = 'inline-block';
      submitBtn.querySelector('.btn-label').textContent = 'Workingâ€¦';
      const resp = await fetch('/shorten', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ url })
      });

      const data = await safeParseJSON(resp);

      if (!resp.ok) {
        const msg = data.error || data._rawText || (data._parseError ? 'Malformed server response' : 'Unknown error');
        throw new Error(msg);
      }

      if (!data.short_url) {
        throw new Error('Server response missing short_url');
      }

      const html = `
        <strong>Short URL:</strong><br />
        <code><a href="${data.short_url}" target="_blank" rel="noopener">${data.short_url}</a></code>
        <div class="actions">
          <button class="btn-alt" type="button" id="copy-btn" aria-label="Copy short URL">ðŸ“‹ Copy</button>
          <button class="btn-alt" type="button" id="open-btn" aria-label="Open short URL in new tab">ðŸ”— Open</button>
        </div>
      `;
      resultBox.innerHTML = html;
      resultBox.style.display = 'block';
      resultBox.classList.add('fade-in');
      // Attach action handlers
      const copyBtn = document.getElementById('copy-btn');
      const openBtn = document.getElementById('open-btn');
      copyBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(data.short_url);
          copiedIndicator.classList.add('show');
          setTimeout(()=>copiedIndicator.classList.remove('show'), 1500);
        } catch(e){
          alert('Copy failed: ' + e.message);
        }
      };
      openBtn.onclick = () => window.open(data.short_url, '_blank', 'noopener');
      urlInput.select();
    } catch(err){
      errorBox.textContent = err.message || 'Unexpected error';
    } finally {
      submitBtn.disabled = false;
      spinner.style.display = 'none';
      submitBtn.querySelector('.btn-label').textContent = 'Shorten';
    }
  });
</script>
</body>
</html>
